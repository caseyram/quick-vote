# Milestone v1.2: Response Templates

**Status:** SHIPPED 2026-02-10
**Phases:** 11-15
**Total Plans:** 11

## Overview

Introduce reusable response templates to eliminate participant confusion from inconsistent multiple choice layouts. Templates lock down option order, colors, and layout across all questions that use them. Includes full CRUD, template assignment, consistent rendering, export/import support, and admin results alignment.

## Phases

### Phase 11: Template Database & CRUD

**Goal**: Admin can create, edit, and manage reusable response templates
**Depends on**: Phase 10 (v1.1 complete)
**Plans**: 3 plans

Plans:
- [x] 11-01: Database migration, TypeScript types, Zustand store, Supabase API functions
- [x] 11-02: Template management UI (list, editor with DnD, delete confirmation, AdminSession integration)
- [x] 11-03: Database migration application and human verification of all TMPL requirements

**Details:**
- Database: `response_templates` table with id, name, options (JSONB array), created_at, updated_at
- Zustand store: Template management methods (create, update, delete, list)
- UI: ResponseTemplatePanel and TemplateEditor with drag-and-drop option reordering
- RLS: Global read/write policies for authenticated users
- Inline PL/pgSQL trigger for updated_at (moddatetime extension unavailable)

### Phase 12: Template Assignment & Defaults

**Goal**: Admin can assign templates to questions and set session defaults
**Depends on**: Phase 11
**Plans**: 3 plans

Plans:
- [x] 12-01: Database migration for session default_template_id, TypeScript types, checkQuestionVotes helper, session store method
- [x] 12-02: TemplateSelector component and template-aware QuestionForm with locked/unlocked modes, detach, and vote guard
- [x] 12-03: Session default template UI in AdminSession settings, bulk apply, migration application, and human verification

**Details:**
- Database: `template_id` FK on questions, `default_template_id` FK on sessions (both ON DELETE SET NULL)
- TemplateSelector: Native HTML select with lock/unlock toggle
- Vote protection: Blocks template changes on questions with existing votes
- Bulk apply: Sets both template_id AND options for immediate UI sync
- 5 bugs found and fixed during human verification

### Phase 13: Consistent Rendering

**Goal**: Template-linked questions display identically for participants
**Depends on**: Phase 12
**Plans**: 2 plans

Plans:
- [x] 13-01: Template-aware participant rendering (VoteMultipleChoice refactor, template loading in ParticipantSession, tests)
- [x] 13-02: Human verification of consistent rendering in live and batch modes

**Details:**
- Display order derived from template.options when template_id present, falls back to question.options
- Position-based color mapping (MULTI_CHOICE_COLORS[index]) unchanged
- Template loading via fetchTemplates() in ParticipantSession useEffect
- buildConsistentBarData accepts optional templateOptions parameter (backwards compatible)
- 4 new template rendering tests added

### Phase 14: Export/Import Integration

**Goal**: Templates travel with session data through JSON export/import
**Depends on**: Phase 13
**Plans**: 2 plans

Plans:
- [x] 14-01: Extend Zod schemas and both export/import functions with template support
- [x] 14-02: Wire templates into UI components and add tests for schema extensions and backward compatibility

**Details:**
- Export: Template ID-to-name mapping for portability across instances
- Import: Name-based deduplication (reuse if match, update if options differ)
- Backward compatibility: templates field optional in schemas
- Import ordering: templates before questions for FK constraint satisfaction
- 25 export/import tests passing (9 new template tests, 3 backward compat)

### Phase 15: Admin Results Template Ordering

**Goal**: Admin result views display bar chart columns in template-defined order
**Depends on**: Phase 14
**Plans**: 1 plan

Plans:
- [x] 15-01: Replace inline aggregated.map() with buildConsistentBarData() in AdminSession and SessionResults

**Details:**
- Closes tech debt items #1 and #2 from milestone audit
- 3-arg buildConsistentBarData pattern: pass live template from store
- Explicit fetchTemplates() calls in AdminSession.tsx and SessionResults.tsx
- All three admin result views (Previous Results grid, ActiveQuestionHero, SessionResults) aligned

---

## Milestone Summary

**Key Decisions:**
- JSONB array storage for template options (simpler than normalized table)
- ON DELETE SET NULL preserves question options when template deleted
- Global RLS policies (all authenticated users can CRUD templates)
- Native HTML select for TemplateSelector (not react-select)
- Name-based template deduplication for export/import portability
- Templates stored globally in Supabase (not session-specific)

**Issues Resolved:**
- 5 bugs found during Phase 12 human verification (column reference, inline editing, bulk apply sync, button types, error handling)
- Admin results ordering mismatch (closed by Phase 15)
- Template loading timing dependency (closed by Phase 15)

**Issues Deferred:**
- None — all tech debt items resolved

**Technical Debt Incurred:**
- None — 0 remaining tech debt items after Phase 15

---

_For current project status, see .planning/ROADMAP.md_
