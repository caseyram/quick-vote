---
phase: 26-sequence-results-enhancements
plan: 02
type: execute
wave: 2
depends_on: ["26-01"]
files_modified:
  - src/components/VoteProgressBar.tsx
  - src/components/SequenceItemCard.tsx
  - src/components/SequenceManager.tsx
  - src/components/PresentationControls.tsx
  - src/pages/AdminSession.tsx
autonomous: true

must_haves:
  truths:
    - "Active batch sequence card shows live progress bar with numeric count instead of 'Results ready'"
    - "Progress bar updates in real-time as votes arrive via Supabase subscription"
    - "Progress bar turns green when all participants have voted on all batch questions"
    - "Draft session config shows only: session name, teams, reasons toggle, test mode toggle"
    - "No slide uploading, template panels, import/export, or default template selector in session config"
  artifacts:
    - path: "src/components/VoteProgressBar.tsx"
      provides: "Reusable progress bar with numeric vote count"
      exports: ["VoteProgressBar"]
    - path: "src/components/SequenceItemCard.tsx"
      provides: "Conditional progress bar rendering for batch items in live mode"
      contains: "VoteProgressBar"
    - path: "src/pages/AdminSession.tsx"
      provides: "Simplified draft config with only runtime settings"
  key_links:
    - from: "src/components/SequenceItemCard.tsx"
      to: "src/components/VoteProgressBar.tsx"
      via: "import and render"
      pattern: "VoteProgressBar"
    - from: "src/components/SequenceManager.tsx"
      to: "src/components/SequenceItemCard.tsx"
      via: "sessionVotes and participantCount props"
      pattern: "sessionVotes=\\{"
    - from: "src/components/PresentationControls.tsx"
      to: "src/components/SequenceManager.tsx"
      via: "sessionVotes and participantCount props"
      pattern: "sessionVotes=\\{"
---

<objective>
Add live vote completion progress bars to active batch cards in the sequence sidebar, and simplify the session configuration page to show only runtime settings.

Purpose: Admins need to see voting progress at a glance (not just "Results ready"), and the session config page should focus on runtime settings since content editing now lives in the template editor.
Output: VoteProgressBar component rendering on active batch cards, simplified AdminSession draft view.
</objective>

<execution_context>
@C:/Users/cramo/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/cramo/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/26-sequence-results-enhancements/26-RESEARCH.md
@.planning/phases/26-sequence-results-enhancements/26-01-SUMMARY.md

@src/components/SequenceManager.tsx
@src/components/SequenceItemCard.tsx
@src/components/PresentationControls.tsx
@src/pages/AdminSession.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create VoteProgressBar and wire live vote data through sequence cards</name>
  <files>
    src/components/VoteProgressBar.tsx
    src/components/SequenceItemCard.tsx
    src/components/SequenceManager.tsx
    src/components/PresentationControls.tsx
  </files>
  <action>
**Create `src/components/VoteProgressBar.tsx`:**

A small, reusable progress bar component showing vote completion for a batch.

```typescript
interface VoteProgressBarProps {
  batchQuestionIds: string[];
  sessionVotes: Record<string, Vote[]>;
  participantCount: number;
}
```

**Implementation:**
- Calculate `totalVotes` by summing `sessionVotes[qId]?.length || 0` across all `batchQuestionIds`.
- Calculate `totalExpected` as `batchQuestionIds.length * participantCount`.
- Calculate `percent` as `Math.min(100, (totalVotes / totalExpected) * 100)` — guard against division by zero (return 0 if `totalExpected === 0`).
- Check `allComplete`: every batch question has `votes >= participantCount` AND `participantCount > 0`.
- Bar color: `bg-green-500` when `allComplete`, `bg-blue-500` otherwise.
- Render: A flex row with a Tailwind progress bar (h-2, rounded-full, bg-gray-200 track, colored fill with `transition-all duration-300`) and a text label showing `totalVotes/totalExpected`.
- Text label: `text-xs text-gray-500 font-medium whitespace-nowrap`.
- Import `Vote` type from `../types/database`.

**Extend SequenceItemCard props:**
Add optional props to `SequenceItemCardProps`:
- `batchQuestionIds?: string[]` — question IDs belonging to this batch
- `sessionVotes?: Record<string, Vote[]>` — current vote state
- `participantCount?: number` — number of connected participants

**Render progress bar in SequenceItemCard:**
In the batch content area (where it currently shows `{questionCount} questions`), add a conditional rendering:
- If `batchQuestionIds` and `sessionVotes` and `participantCount !== undefined` AND the batch is in an active state (check via batch prop: `batch?.status === 'active'`), render `<VoteProgressBar>` BELOW the question count line.
- For non-active batches, show the existing question count only (no progress bar).
- For closed batches with vote data available, show the final count as a static completed bar (green, 100%).

Import `VoteProgressBar` and `Vote` type in SequenceItemCard.

**Extend SequenceManager props:**
Add optional props to `SequenceManagerProps`:
- `sessionVotes?: Record<string, Vote[]>`
- `participantCount?: number`

Pass these through to each `SequenceItemCard`. Also compute and pass `batchQuestionIds` for each batch item:
```typescript
batchQuestionIds={
  item.item_type === 'batch' && item.batch_id
    ? questions.filter(q => q.batch_id === item.batch_id).map(q => q.id)
    : undefined
}
```

This applies to BOTH live mode and draft mode card rendering (progress bars only render when batch is active, so draft mode cards won't show them).

**Wire data from PresentationControls to SequenceManager:**
In `PresentationControls.tsx`, where `<SequenceManager>` is rendered (around line 345), add the new props:
```tsx
<SequenceManager
  sessionId={sessionId}
  ...existing props...
  sessionVotes={sessionVotes}
  participantCount={participantCount}
/>
```

`sessionVotes` and `participantCount` are already available as props in PresentationControls.
  </action>
  <verify>
Run `npx tsc --noEmit` — no type errors. During active session with votes coming in, the batch card in the sequence sidebar shows a blue progress bar with "X/Y" count. When all participants vote on all batch questions, bar turns green.
  </verify>
  <done>
VoteProgressBar component created. Active batch cards in sequence sidebar show live progress bars. Progress updates in real-time via existing Supabase realtime subscription (no new subscriptions needed). Bar turns green at 100% completion.
  </done>
</task>

<task type="auto">
  <name>Task 2: Simplify AdminSession draft view to runtime-only settings</name>
  <files>
    src/pages/AdminSession.tsx
  </files>
  <action>
Strip the AdminSession draft view to keep only runtime settings. Content editing (slides, questions, templates) lives exclusively in the template editor.

**REMOVE from the draft view JSX (the `{isDraft && (...)}` block):**

1. **Image uploader section** — the entire block containing `<ImageUploader>` and its wrapper div with "Add Slide" heading (around lines 1347-1351).
2. **SessionImportExport section** — the entire block containing `<SessionImportExport>` and its wrapper div (around lines 1353-1382).
3. **ResponseTemplatePanel** — `<ResponseTemplatePanel />` (around line 1386).
4. **TemplatePanel** — `<TemplatePanel sessionId={session.session_id} />` (around line 1387).
5. **SessionTemplatePanel** — `<SessionTemplatePanel sessionId={session.session_id} />` (around line 1390).
6. **Default Template selector** — the entire `pt-3 border-t` div containing the "Default Template" label, description text, and `<TemplateSelector>` component (around lines 1212-1224).

**KEEP in the draft view:**
- Header with session title, draft badge, and delete button
- Participant link sharing section
- Session Settings section with reasons toggle and test mode toggle (remove the default template section from within it)
- Team Configuration section
- Session Sequence section with SequenceManager, expanded batch detail panel

**REMOVE unused imports** that are no longer needed after the JSX removals:
- `ImageUploader` (if no other usage)
- `SessionImportExport` (if no other usage)
- `ResponseTemplatePanel` (if no other usage)
- `TemplatePanel` (if no other usage)
- `SessionTemplatePanel` (if no other usage)
- `TemplateSelector` (if no other usage)

Also remove related state and handlers that are no longer used:
- `handleSlideUploaded` function — only used by ImageUploader
- `handleDefaultTemplateChange` function — only used by TemplateSelector
- `handleBulkApplyConfirm` and `handleBulkApplyCancel` functions — only used by bulk apply dialog
- `bulkApplyConfirm` and `bulkApplying` state — only used by bulk apply dialog
- `ConfirmDialog` for bulk apply at the bottom of the component (around lines 1504-1521) — no longer needed
- `checkQuestionVotes` import from template-api (only used in handleDefaultTemplateChange)
- `createSlide`, `deleteSlide` imports from slide-api (only used in handleSlideUploaded and handleDeleteSlide)

**KEEP `handleDeleteSlide`** — it's still passed to SequenceManager for deleting existing slides in the sequence.
**KEEP `createSlide` and `deleteSlide` imports** ONLY IF handleDeleteSlide still uses `deleteSlide`. Check usage — `handleDeleteSlide` calls `deleteSlide(item.id, item.slide_image_path!)`, so keep `deleteSlide` import but remove `createSlide` import.

**Verify reasons_enabled default:** The context says "Reasons enabled defaults to ON". Check if the initial state of `session.reasons_enabled` is already `true` when sessions are created. If the session creation flow in the Home page or template editor already sets `reasons_enabled: true`, no change needed. If not, add `reasons_enabled: true` to the session insert payload. Check `src/pages/Home.tsx` or wherever sessions are created to verify. Do NOT change the database default — just ensure the client sends the right initial value.
  </action>
  <verify>
Run `npx tsc --noEmit` — no type errors. Open a draft session — should show only: title, participant link, reasons toggle, test mode toggle, team config, and sequence manager. No image uploader, no template panels, no import/export, no default template selector. All removed features are still accessible via the template editor.
  </verify>
  <done>
AdminSession draft view shows only runtime settings: session name, participant link, reasons/test toggles, team configuration, and sequence manager. All content editing UI removed. No unused imports or dead code remain. Reasons enabled defaults to ON for new sessions.
  </done>
</task>

</tasks>

<verification>
1. Start a live session with a batch containing 3 questions and 2+ participants
2. Navigate to the batch in the sequence sidebar — progress bar shows "0/6" (3 questions x 2 participants)
3. Cast votes from participant windows — progress bar updates in real-time
4. When all participants vote on all questions — bar turns green
5. Open a draft session — confirm only runtime settings visible (no image uploader, template panels, import/export)
6. Verify sequence manager still shows batches and slides with drag-and-drop
7. Verify existing template editor still has all content editing features
</verification>

<success_criteria>
- Active batch cards show live progress bar with "X/Y" vote count
- Progress bar updates in real-time via existing Supabase realtime subscription
- Progress bar turns green when 100% of participants voted on all batch questions
- Draft session config shows only: title, participant link, reasons toggle, test toggle, teams, sequence
- No template panels, image uploader, import/export, or default template selector in session config
- TypeScript compiles without errors
- No unused imports or dead code from removed features
</success_criteria>

<output>
After completion, create `.planning/phases/26-sequence-results-enhancements/26-02-SUMMARY.md`
</output>
