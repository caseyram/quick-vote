---
phase: 09.1-consolidate-batch-go-live
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/VoteAgreeDisagree.tsx
  - src/components/VoteMultipleChoice.tsx
autonomous: true

must_haves:
  truths:
    - "Vote components hide submit button when batchMode=true"
    - "Vote components call onSelectionChange when user makes selection in batch mode"
    - "Vote components initialize from initialSelection/initialReason props in batch mode"
    - "Vote components do not auto-submit when batchMode=true"
  artifacts:
    - path: "src/components/VoteAgreeDisagree.tsx"
      provides: "Agree/Disagree voting with batch mode support"
      contains: "batchMode"
    - path: "src/components/VoteMultipleChoice.tsx"
      provides: "Multiple choice voting with batch mode support"
      contains: "batchMode"
  key_links:
    - from: "VoteAgreeDisagree"
      to: "BatchVotingCarousel"
      via: "batchMode prop and onSelectionChange callback"
      pattern: "batchMode.*true"
    - from: "VoteMultipleChoice"
      to: "BatchVotingCarousel"
      via: "batchMode prop and onSelectionChange callback"
      pattern: "batchMode.*true"
---

<objective>
Verify and document batch mode support in vote components.

Purpose: Ensure VoteAgreeDisagree and VoteMultipleChoice components properly support batch mode where submission is deferred to the parent carousel rather than happening immediately on selection.

Output: Verified vote components with batch mode props fully functional.
</objective>

<execution_context>
@C:\Users\cramo\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\cramo\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/components/VoteAgreeDisagree.tsx
@src/components/VoteMultipleChoice.tsx
@src/components/BatchVotingCarousel.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Verify batch mode props in vote components</name>
  <files>src/components/VoteAgreeDisagree.tsx, src/components/VoteMultipleChoice.tsx</files>
  <action>
Read both vote components and verify they have the required batch mode implementation:

1. Props interface includes:
   - batchMode?: boolean
   - onSelectionChange?: (selection: string | null, reason?: string) => void
   - initialSelection?: string | null
   - initialReason?: string

2. Behavior when batchMode=true:
   - Submit button is hidden (check for `{!batchMode && (` pattern)
   - useEffect initializes from props instead of fetching from database
   - useEffect calls onSelectionChange when selection/reason changes

3. Behavior when batchMode=false (default):
   - Submit button is visible and functional
   - Component fetches existing vote from database on mount
   - Standard submission flow works

If any of these are missing, implement them. If all are present, document the verification.
  </action>
  <verify>
Run: `grep -n "batchMode" src/components/VoteAgreeDisagree.tsx src/components/VoteMultipleChoice.tsx`
Expect: Both files show batchMode prop definition, conditional logic, and onSelectionChange calls.
  </verify>
  <done>
Both vote components have:
- batchMode prop with default false
- Conditional submit button rendering (!batchMode)
- onSelectionChange callback invocation when batchMode=true
- initialSelection/initialReason prop initialization
  </done>
</task>

<task type="auto">
  <name>Task 2: Test batch mode integration with carousel</name>
  <files>src/components/BatchVotingCarousel.tsx</files>
  <action>
Verify BatchVotingCarousel correctly uses batch mode:

1. Check it passes `batchMode={true}` to vote components
2. Check it provides `onSelectionChange` callback that updates `pendingVotes` Map
3. Check it provides `initialSelection` and `initialReason` from pendingVotes state
4. Confirm vote components receive all required props

Run the dev server and manually test:
1. Start session, create batch with 2+ questions
2. Activate batch
3. As participant, navigate to batch
4. Make selection on question 1 - verify no immediate submission
5. Navigate to question 2, make selection
6. Navigate back to question 1 - verify selection is preserved
7. Complete batch - verify all votes submitted together

Document any issues found.
  </action>
  <verify>
Run: `npm run dev`
Manual test: Create batch, activate, vote through carousel, verify selections persist during navigation.
  </verify>
  <done>
BatchVotingCarousel correctly:
- Passes batchMode={true} to vote components
- Tracks selections in local pendingVotes Map
- Preserves selections when navigating between questions
- Submits all votes on final "Submit" button click
  </done>
</task>

</tasks>

<verification>
1. Both vote components export with batchMode support
2. BatchVotingCarousel integrates correctly with vote components
3. Manual test confirms deferred submission works
</verification>

<success_criteria>
- VoteAgreeDisagree has batchMode, onSelectionChange, initialSelection, initialReason props
- VoteMultipleChoice has batchMode, onSelectionChange, initialSelection, initialReason props
- Both components hide submit button when batchMode=true
- Both components call onSelectionChange on selection/reason changes
- BatchVotingCarousel tracks votes locally and submits all at once
</success_criteria>

<output>
After completion, create `.planning/phases/09.1-consolidate-batch-go-live/09.1-01-SUMMARY.md`
</output>
