---
phase: 04-realtime-and-live-session-orchestration
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/BarChart.tsx
  - src/components/CountdownTimer.tsx
  - src/components/ConnectionBanner.tsx
  - src/components/ParticipantCount.tsx
  - .planning/phases/04-realtime-and-live-session-orchestration/realtime-publication.sql
autonomous: true

must_haves:
  truths:
    - "BarChart renders vertical bars with CSS height transitions that animate smoothly as vote data changes"
    - "CountdownTimer shows remaining seconds with visual urgency in the last 5 seconds"
    - "ConnectionBanner displays a dismissible reconnecting/disconnected banner at the top"
    - "ParticipantCount shows connected count with a pulsing live indicator dot"
    - "SQL file contains ALTER PUBLICATION statements for votes and questions tables"
  artifacts:
    - path: "src/components/BarChart.tsx"
      provides: "Vertical bar chart with CSS transitions"
      min_lines: 40
    - path: "src/components/CountdownTimer.tsx"
      provides: "Countdown timer display component"
      min_lines: 20
    - path: "src/components/ConnectionBanner.tsx"
      provides: "Connection status banner"
      min_lines: 15
    - path: "src/components/ParticipantCount.tsx"
      provides: "Participant count with live indicator"
      min_lines: 15
    - path: ".planning/phases/04-realtime-and-live-session-orchestration/realtime-publication.sql"
      provides: "SQL to enable Realtime on votes and questions tables"
      min_lines: 3
  key_links:
    - from: "src/components/BarChart.tsx"
      to: "CSS transitions"
      via: "inline style height + transition property"
      pattern: "transition.*height"
    - from: "src/components/CountdownTimer.tsx"
      to: "timer state"
      via: "remainingSeconds prop"
      pattern: "remainingSeconds"
---

<objective>
Create the UI components (BarChart, CountdownTimer, ConnectionBanner, ParticipantCount) and the SQL prerequisite file that Plans 03-04 will compose into the admin and participant pages.

Purpose: Isolating these presentational components means the heavy page rewrites (Plans 03-04) can focus purely on wiring realtime events to state, not on building UI from scratch.

Output: Four new React components and one SQL file.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-realtime-and-live-session-orchestration/04-CONTEXT.md
@.planning/phases/04-realtime-and-live-session-orchestration/04-RESEARCH.md

@src/lib/vote-aggregation.ts
@src/types/database.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create BarChart and CountdownTimer components</name>
  <files>src/components/BarChart.tsx, src/components/CountdownTimer.tsx</files>
  <action>
Create `src/components/BarChart.tsx`:
- Export a named component `BarChart`.
- Props interface `BarChartProps`:
  - `data: { label: string; count: number; percentage: number; color: string }[]`
  - `totalVotes?: number` (optional, displayed below chart)
- Renders a vertical bar chart using flexbox (`flex items-end justify-center gap-6`).
- Container height: 300px (inline style).
- Each bar is a flex column with:
  - Count + percentage label above the bar (`{count} ({percentage}%)`), styled `text-sm font-medium text-white`.
  - A bar container div (`w-full flex-1 flex items-end`).
  - The actual bar div with:
    - `className="w-full rounded-t-lg"`
    - `style={{ height: \`${percentage}%\`, backgroundColor: color, transition: 'height 0.5s ease-out', minHeight: count > 0 ? '4px' : '0px' }}`
  - Label below the bar (`text-sm text-gray-300 text-center`).
- Below the chart, if `totalVotes` is provided, show "Total: X votes" in `text-xs text-gray-500`.
- Color palette constants exported for consumers:
  - `AGREE_DISAGREE_COLORS = { agree: '#3B82F6', disagree: '#F97316' }` (blue/orange, neutral)
  - `MULTI_CHOICE_COLORS = ['#6366F1', '#EC4899', '#14B8A6', '#F59E0B', '#8B5CF6', '#EF4444', '#10B981', '#F472B6']` (8 distinct colors for up to 8 options)

Create `src/components/CountdownTimer.tsx`:
- Export a named component `CountdownTimer`.
- Props interface `CountdownTimerProps`:
  - `remainingSeconds: number` (integer seconds remaining)
  - `isRunning: boolean`
- Only renders when `isRunning` is true (returns null otherwise).
- Displays remaining seconds in a compact format.
- Layout: small pill-shaped badge (`inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-sm font-medium`).
- Shows a small clock SVG icon (16x16) + seconds number + "s" suffix.
- Normal state: `bg-gray-800 text-gray-300`.
- Urgency state (remainingSeconds <= 5): `bg-red-900 text-red-300` with a CSS `animate-pulse` class on the badge.
- The timer should feel subtle and non-distracting per CONTEXT.md ("small, non-distracting, in the corner").
  </action>
  <verify>Run `npx tsc --noEmit`. Zero errors. Both files exist and export the documented components.</verify>
  <done>BarChart renders vertical bars with CSS height transitions and exported color constants. CountdownTimer shows compact seconds display with pulsing urgency in last 5 seconds.</done>
</task>

<task type="auto">
  <name>Task 2: Create ConnectionBanner, ParticipantCount, and SQL file</name>
  <files>src/components/ConnectionBanner.tsx, src/components/ParticipantCount.tsx, .planning/phases/04-realtime-and-live-session-orchestration/realtime-publication.sql</files>
  <action>
Create `src/components/ConnectionBanner.tsx`:
- Export a named component `ConnectionBanner`.
- Props: `status: 'connecting' | 'connected' | 'reconnecting' | 'disconnected'`.
- Returns null when `status === 'connected'` or `status === 'connecting'` (no banner needed on initial connect).
- When `status === 'reconnecting'`: renders a fixed top banner (full-width, z-50) with yellow background (`bg-yellow-900 text-yellow-200`) showing "Reconnecting..." with a small spinner SVG (animate-spin).
- When `status === 'disconnected'`: renders the same banner but red (`bg-red-900 text-red-200`) showing "Connection lost. Please refresh if this persists."
- Banner auto-dismisses when status returns to 'connected' (handled by parent re-render with 'connected' status).
- Styling: `fixed top-0 left-0 right-0 z-50 py-2 px-4 text-center text-sm font-medium`.

Create `src/components/ParticipantCount.tsx`:
- Export a named component `ParticipantCount`.
- Props: `count: number`.
- Renders an inline badge with:
  - A small pulsing green dot (6x6 circle, `bg-green-500 rounded-full animate-pulse`).
  - Text: `{count} connected` (singular "1 connected", plural otherwise).
- Styled as a compact inline element: `inline-flex items-center gap-2 text-sm text-gray-300`.
- When count is 0, shows "0 connected" with a gray dot instead of green (no pulse).

Create `.planning/phases/04-realtime-and-live-session-orchestration/realtime-publication.sql`:
- SQL comments explaining this must be run in Supabase SQL Editor before Phase 4 testing.
- `ALTER PUBLICATION supabase_realtime ADD TABLE votes;`
- `ALTER PUBLICATION supabase_realtime ADD TABLE questions;`
- Note: These statements are idempotent-safe in PostgreSQL 10+ (will error if already added, so include `-- Run these one at a time; skip if already added` comment).
  </action>
  <verify>Run `npx tsc --noEmit`. Zero errors. All three files exist.</verify>
  <done>ConnectionBanner shows reconnecting/disconnected banners. ParticipantCount shows live count with pulsing dot. SQL file ready for manual execution in Supabase dashboard.</done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes with zero errors
- `npm run build` succeeds
- All four component files exist and export named components
- SQL file exists at `.planning/phases/04-realtime-and-live-session-orchestration/realtime-publication.sql`
- BarChart uses inline `transition: 'height 0.5s ease-out'` for smooth animation
- CountdownTimer uses `animate-pulse` for urgency in last 5 seconds
</verification>

<success_criteria>
- All five artifacts created and TypeScript-clean
- Components are pure presentational (no side effects, no data fetching)
- BarChart color constants exported for consistent use across admin pages
- SQL file documents the prerequisite for Realtime Postgres Changes
</success_criteria>

<output>
After completion, create `.planning/phases/04-realtime-and-live-session-orchestration/04-02-SUMMARY.md`
</output>
