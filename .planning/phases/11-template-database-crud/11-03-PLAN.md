---
phase: 11-template-database-crud
plan: 03
type: execute
wave: 3
depends_on: ["11-02"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Admin can visually create a template with a name and at least 2 options"
    - "Admin can edit a template: rename, reorder options via drag, add/remove options"
    - "Admin can delete a template and sees usage count warning in confirmation"
    - "Templates persist across page refresh (Supabase-backed)"
    - "Option edits blocked when linked questions have votes"
  artifacts: []
  key_links: []
---

<objective>
Verify the complete template CRUD workflow works correctly in the browser.

Purpose: Confirm that all Phase 11 requirements (TMPL-01 through TMPL-04) are met before moving to Phase 12.
Output: Human confirmation that template management works end-to-end.
</objective>

<execution_context>
@C:\Users\cramo\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\cramo\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/11-template-database-crud/11-CONTEXT.md
@.planning/phases/11-template-database-crud/11-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Apply database migration to Supabase</name>
  <files></files>
  <action>
Run the SQL migration from `supabase/migrations/20250209_010_response_templates.sql` against the project's Supabase instance.

Use the Supabase CLI if available: `npx supabase db push` or apply via the Supabase dashboard SQL editor.

If the Supabase CLI is not configured for remote, guide the user to apply the migration manually via the Supabase dashboard SQL editor. Read the migration file and present the SQL to be executed.

Verify the migration was applied:
- Check that `response_templates` table exists
- Check that `questions` table has `template_id` column
- Check RLS policies are in place
  </action>
  <verify>Query `SELECT * FROM response_templates LIMIT 1` does not error (table exists). Query `SELECT template_id FROM questions LIMIT 1` does not error (column exists).</verify>
  <done>Database migration applied successfully — response_templates table and questions.template_id column exist in Supabase.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete template CRUD system:
1. Database: response_templates table in Supabase with RLS, constraints, and questions.template_id FK
2. Data layer: TypeScript types, Zustand store, Supabase API functions
3. UI: ResponseTemplatePanel with template list, TemplateEditor modal with drag-and-drop option reordering, delete confirmation with usage count, edit propagation guards
4. Integration: ResponseTemplatePanel replaces old TemplatePanel in AdminSession draft view
  </what-built>
  <how-to-verify>
1. Start the dev server: `npm run dev`
2. Navigate to an admin session in draft mode
3. Scroll down to find the "Response Templates" section

**TMPL-01: Create template**
4. Click "+ Create Template"
5. Enter template name: "Agreement Scale"
6. Add options: "Strongly Agree", "Agree", "Neutral", "Disagree", "Strongly Disagree"
7. Click "Create Template"
8. Verify template appears in list with name and options preview

**TMPL-02: Edit template**
9. Click "Edit" on the template you just created
10. Rename to "5-Point Agreement"
11. Drag "Neutral" to a different position (test drag-and-drop)
12. Remove one option, then add it back
13. Save — verify changes persist

**Validation checks:**
14. Try to create a template with the same name — should show error
15. Try to save with only 1 option — should show error
16. Try to save with duplicate option text — should show error
17. Try to save with empty name — should show error

**TMPL-03: Delete template**
18. Create a second template "Yes/No" with options "Yes", "No"
19. Click "Delete" on "Yes/No" — should show confirmation dialog
20. Confirm delete — template should disappear from list

**TMPL-04: Persistence**
21. Refresh the page
22. Navigate back to the admin session draft view
23. Verify "5-Point Agreement" template is still there with correct options

Type "approved" if all checks pass, or describe any issues found.
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues</resume-signal>
</task>

</tasks>

<verification>
All four TMPL requirements verified via manual browser testing:
- TMPL-01: Create works with name + ordered options
- TMPL-02: Edit works (rename, reorder via drag, add/remove options)
- TMPL-03: Delete works with confirmation showing usage count
- TMPL-04: Templates persist in Supabase across page refreshes
</verification>

<success_criteria>
- Human confirms all TMPL-01 through TMPL-04 requirements work correctly
- No visual bugs or broken interactions
- Templates persist across page refresh
</success_criteria>

<output>
After completion, create `.planning/phases/11-template-database-crud/11-03-SUMMARY.md`
</output>
