---
phase: 24.1-presentation-only-active-mode
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/PresentationControls.tsx
  - src/pages/AdminSession.tsx
autonomous: true
must_haves:
  truths:
    - "Admin sees timer duration pills (15s, 30s, 60s, None) in the right sidebar of PresentationControls"
    - "Admin can type a quick question and press Go Live to create and activate it immediately"
    - "Admin sees a connection status indicator (green/yellow/red dot) in the right sidebar"
    - "Go Live creates an agree/disagree question and broadcasts question_activated to projection"
    - "Timer countdown starts automatically when Go Live is pressed with a timer duration set"
  artifacts:
    - path: "src/components/PresentationControls.tsx"
      provides: "Timer config, Go Live quick question, active question status, connection status indicator"
      contains: "timerOptions, quickText, connectionStatus rendering, CountdownTimer"
  key_links:
    - from: "src/components/PresentationControls.tsx"
      to: "channelRef.current?.send"
      via: "Go Live broadcasts question_activated"
      pattern: "question_activated"
    - from: "src/components/PresentationControls.tsx"
      to: "connectionStatus prop"
      via: "status indicator rendering"
      pattern: "connectionStatus"
    - from: "src/pages/AdminSession.tsx"
      to: "src/components/PresentationControls.tsx"
      via: "new props: onQuickQuestion, quickQuestionLoading, countdownRemaining, countdownRunning, onCloseVoting"
      pattern: "onQuickQuestion="
---

<objective>
Add Go Live, timer config, and connection status to PresentationControls right sidebar.

Purpose: PresentationControls is about to become the only active session view (Plan 02). Before removing the old view, it must have feature parity for timer configuration, quick question creation (Go Live), and connection status display. All three patterns exist in AdminControlBar and AdminSession — this plan relocates them.

Output: PresentationControls.tsx with three new sections in the right sidebar: timer duration pills, Go Live input + button, and connection status indicator.
</objective>

<execution_context>
@C:/Users/cramo/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/cramo/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/24.1-presentation-only-active-mode/24.1-RESEARCH.md
@src/components/PresentationControls.tsx
@src/components/AdminControlBar.tsx
@src/pages/AdminSession.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add timer config, Go Live, and connection status to PresentationControls right sidebar</name>
  <files>src/components/PresentationControls.tsx</files>
  <action>
Add three new features to the PresentationControls right sidebar (the `w-64` div on the right). All patterns come directly from existing code — relocate, don't reinvent.

**1. New props needed:**

Add these new props to PresentationControlsProps interface:
- `onQuickQuestion: (text: string, timerDuration: number | null) => void` — handler from AdminSession (handleQuickQuestion)
- `quickQuestionLoading: boolean` — loading state from AdminSession
- `countdownRemaining: number` — from useCountdown in AdminSession
- `countdownRunning: boolean` — from useCountdown in AdminSession
- `onCloseVoting: (questionId: string) => void` — handler from AdminSession (handleCloseVotingInternal)

Note: `connectionStatus` is already in the props interface but is not currently used in the component body. It IS already passed from AdminSession line 1552.

**2. Timer Duration Pills (add ABOVE "QR Code" section):**

Copy the timerOptions pattern from AdminControlBar (lines 38-43):
```typescript
const timerOptions = [
  { label: '15s', value: 15 },
  { label: '30s', value: 30 },
  { label: '60s', value: 60 },
  { label: 'None', value: null },
] as const;
```

Add local state: `const [timerDuration, setTimerDuration] = useState<number | null>(30);`

Render timer pills in right sidebar as the FIRST section:
```tsx
<div>
  <h3 className="text-sm font-semibold text-gray-700 mb-2">Timer Duration</h3>
  <div className="flex flex-wrap gap-2">
    {timerOptions.map((opt) => (
      <button
        key={opt.label}
        onClick={() => setTimerDuration(opt.value)}
        className={`px-3 py-1.5 rounded text-sm font-medium transition-colors ${
          timerDuration === opt.value
            ? 'bg-indigo-600 text-white'
            : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
        }`}
      >
        {opt.label}
      </button>
    ))}
  </div>
</div>
```

**3. Go Live Quick Question (add AFTER timer pills):**

Add local state: `const [quickText, setQuickText] = useState('');`

Render input + button:
```tsx
<div>
  <h3 className="text-sm font-semibold text-gray-700 mb-2">Go Live</h3>
  <input
    type="text"
    value={quickText}
    onChange={(e) => setQuickText(e.target.value)}
    placeholder="Type a question..."
    className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm mb-2"
    onKeyDown={(e) => {
      if (e.key === 'Enter' && quickText.trim()) {
        e.preventDefault();
        onQuickQuestion(quickText, timerDuration);
        setQuickText('');
      }
    }}
  />
  <button
    onClick={() => {
      onQuickQuestion(quickText, timerDuration);
      setQuickText('');
    }}
    disabled={!quickText.trim() || quickQuestionLoading}
    className="w-full px-3 py-2 bg-green-600 hover:bg-green-500 disabled:bg-gray-300 disabled:cursor-not-allowed text-white text-sm font-medium rounded-lg transition-colors"
  >
    {quickQuestionLoading ? 'Going Live...' : 'Go Live'}
  </button>
</div>
```

**4. Active Question Status (add AFTER Go Live):**

Import CountdownTimer from './CountdownTimer'. Show current active question status when there is an active question (using questions from useSessionStore):
```tsx
{(() => {
  const activeQ = questions.find(q => q.status === 'active');
  if (!activeQ) return null;
  return (
    <div className="p-3 bg-yellow-50 border border-yellow-200 rounded-lg space-y-2">
      <h3 className="text-sm font-semibold text-yellow-800">Voting Active</h3>
      <p className="text-xs text-yellow-700 truncate">{activeQ.text}</p>
      {countdownRunning && (
        <CountdownTimer
          remainingSeconds={Math.ceil(countdownRemaining / 1000)}
          isRunning={countdownRunning}
          theme="light"
        />
      )}
      <button
        onClick={() => onCloseVoting(activeQ.id)}
        className="w-full px-3 py-1.5 bg-red-600 hover:bg-red-500 text-white text-xs font-medium rounded-lg transition-colors"
      >
        Close Voting
      </button>
    </div>
  );
})()}
```

**5. Connection Status Indicator (add AFTER "Keyboard Shortcuts" section, before the closing `</div>` of the right sidebar):**

Add a compact status indicator. The connectionStatus prop is already in the interface.

```tsx
<div className="pt-4 border-t border-gray-200">
  <div className="flex items-center gap-2 text-xs">
    <div className={`w-2 h-2 rounded-full ${
      connectionStatus === 'connected' ? 'bg-green-500' :
      connectionStatus === 'reconnecting' ? 'bg-yellow-500 animate-pulse' :
      connectionStatus === 'disconnected' ? 'bg-red-500' :
      'bg-gray-400 animate-pulse'
    }`} />
    <span className={
      connectionStatus === 'connected' ? 'text-green-600' :
      connectionStatus === 'reconnecting' ? 'text-yellow-600' :
      connectionStatus === 'disconnected' ? 'text-red-600' :
      'text-gray-500'
    }>
      {connectionStatus === 'connected' ? 'Connected' :
       connectionStatus === 'reconnecting' ? 'Reconnecting...' :
       connectionStatus === 'disconnected' ? 'Disconnected' :
       'Connecting...'}
    </span>
  </div>
</div>
```

**Section order in right sidebar (top to bottom):**
1. Timer Duration (pills)
2. Go Live (input + button)
3. Active Question Status (conditional, shows when voting active)
4. QR Code (existing)
5. Presentation (existing black screen toggle)
6. Participant Count (existing)
7. Keyboard Shortcuts (existing)
8. Connection Status (new, at bottom)

**Important:** Do NOT modify AdminSession.tsx in this plan. Do NOT remove the `onExitPresentationMode` prop yet — that happens in Plan 02. The keyboard shortcut handler must NOT intercept typing in the new quick question input (it already has the target.tagName check for INPUT, so this works automatically).
  </action>
  <verify>
Run `npx tsc --noEmit` and confirm no TypeScript errors. The new props will initially not be passed from AdminSession (since we're not modifying it yet) but the type interface change will cause a type error at the callsite — this is expected and resolved in Plan 02. To verify in isolation, temporarily check PresentationControls.tsx for correct syntax and structure.

Alternative: Run `npx tsc --noEmit 2>&1 | head -20` and confirm errors are ONLY about missing props at the AdminSession.tsx callsite (lines ~1548-1558), not internal PresentationControls errors.
  </verify>
  <done>
PresentationControls right sidebar displays timer duration pills (defaulting to 30s), Go Live input with button, active question status with countdown and close button, and connection status indicator. All patterns match existing AdminControlBar/AdminSession implementations.
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire new PresentationControls props from AdminSession</name>
  <files>src/pages/AdminSession.tsx</files>
  <action>
Update the PresentationControls usage in AdminSession.tsx (around lines 1548-1558) to pass the new props:

Find the existing PresentationControls JSX (approximately lines 1548-1559):
```tsx
<PresentationControls
  sessionId={session.session_id}
  sessionTitle={session.title}
  participantCount={participantCount}
  connectionStatus={connectionStatus}
  channelRef={channelRef}
  sessionVotes={sessionVotes}
  onActivateSequenceItem={handleActivateSequenceItem}
  onEndSession={handleEndSession}
  onExitPresentationMode={() => setPresentationMode(false)}
/>
```

Add the new props:
```tsx
<PresentationControls
  sessionId={session.session_id}
  sessionTitle={session.title}
  participantCount={participantCount}
  connectionStatus={connectionStatus}
  channelRef={channelRef}
  sessionVotes={sessionVotes}
  onActivateSequenceItem={handleActivateSequenceItem}
  onEndSession={handleEndSession}
  onExitPresentationMode={() => setPresentationMode(false)}
  onQuickQuestion={handleQuickQuestion}
  quickQuestionLoading={quickQuestionLoading}
  countdownRemaining={countdownRemaining}
  countdownRunning={countdownRunning}
  onCloseVoting={handleCloseVotingInternal}
/>
```

All handler functions (`handleQuickQuestion`, `handleCloseVotingInternal`) and state variables (`quickQuestionLoading`, `countdownRemaining`, `countdownRunning`) already exist in AdminSession.tsx — they are already used by AdminControlBar.
  </action>
  <verify>Run `npx tsc --noEmit` and confirm zero TypeScript errors. The app should compile cleanly with all new props wired.</verify>
  <done>PresentationControls receives all new props from AdminSession. TypeScript compiles cleanly. Go Live, timer config, close voting, and connection status are fully wired through the component tree.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with zero errors
2. PresentationControls right sidebar renders timer pills, Go Live input, connection indicator
3. All existing PresentationControls functionality (QR toggle, black screen, navigation, sequence list) is preserved
4. Keyboard shortcuts still work (B for black screen, arrows for navigation, ? for help) and do not conflict with typing in Go Live input
</verification>

<success_criteria>
- Timer duration pills render in PresentationControls right sidebar with 30s default
- Go Live input accepts text and triggers question creation on Enter or button click
- Connection status dot shows correct color for connected/reconnecting/disconnected states
- Active question status shows when voting is live, with countdown timer and close button
- All props wired from AdminSession with zero TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/24.1-presentation-only-active-mode/24.1-01-SUMMARY.md`
</output>
