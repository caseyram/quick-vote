---
phase: 24.1-presentation-only-active-mode
plan: 02
type: execute
wave: 2
depends_on: ["24.1-01"]
files_modified:
  - src/pages/AdminSession.tsx
  - src/components/PresentationControls.tsx
  - src/components/AdminControlBar.tsx
autonomous: false
must_haves:
  truths:
    - "When session status is active, AdminSession renders ONLY PresentationControls (no non-presentation admin view)"
    - "There is no 'Enter Presentation' button or presentationMode toggle anywhere"
    - "AdminControlBar is NOT rendered when session status is active"
    - "Draft and Lobby views are unchanged"
    - "Ended view is unchanged"
    - "PresentationControls has no Exit button or onExitPresentationMode prop"
  artifacts:
    - path: "src/pages/AdminSession.tsx"
      provides: "Simplified active session rendering with single view"
    - path: "src/components/PresentationControls.tsx"
      provides: "Standalone active session view without exit callback"
    - path: "src/components/AdminControlBar.tsx"
      provides: "Draft/lobby-only control bar (no active state rendering)"
  key_links:
    - from: "src/pages/AdminSession.tsx"
      to: "src/components/PresentationControls.tsx"
      via: "direct render when isActive"
      pattern: "isActive.*PresentationControls"
    - from: "src/pages/AdminSession.tsx"
      to: "src/components/AdminControlBar.tsx"
      via: "render only when NOT active"
      pattern: "!isActive.*AdminControlBar"
---

<objective>
Remove the non-presentation active session view from AdminSession.tsx. Make PresentationControls the only view when a session is active. Remove presentationMode state toggle, Exit button, and onExitPresentationMode prop.

Purpose: Eliminates the dual-view cognitive load — admin no longer chooses between two active session interfaces. PresentationControls (now feature-complete from Plan 01) is the single active session experience.

Output: Simplified AdminSession.tsx with ~260 fewer lines of redundant active view code, cleaned-up PresentationControls without Exit button, and AdminControlBar without active-state awareness.
</objective>

<execution_context>
@C:/Users/cramo/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/cramo/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/24.1-presentation-only-active-mode/24.1-RESEARCH.md
@.planning/phases/24.1-presentation-only-active-mode/24.1-01-SUMMARY.md
@src/pages/AdminSession.tsx
@src/components/PresentationControls.tsx
@src/components/AdminControlBar.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove non-presentation active view and presentationMode from AdminSession</name>
  <files>src/pages/AdminSession.tsx, src/components/PresentationControls.tsx</files>
  <action>
**Step 1: Remove presentationMode state from AdminSession.tsx**

Delete the state declaration (line 73):
```typescript
const [presentationMode, setPresentationMode] = useState(false);
```

**Step 2: Remove the non-presentation active view block**

Delete the entire block from `{isActive && !presentationMode && (` through its matching closing `)}` (approximately lines 1277-1544). This is the large block containing:
- Left sidebar with SequenceManager (lines 1279-1296)
- Right main area with header bar, "Enter Presentation" button, progress dashboard, timer bar, hero projection area, results navigation, previous results grid (lines 1298-1543)

**Step 3: Simplify PresentationControls rendering**

Change the PresentationControls guard from `{isActive && presentationMode && (` to just `{isActive && (`:

Before:
```tsx
{isActive && presentationMode && (
  <PresentationControls ... />
)}
```

After:
```tsx
{isActive && (
  <PresentationControls ... />
)}
```

Remove `onExitPresentationMode={() => setPresentationMode(false)}` from the PresentationControls props.

**Step 4: Simplify AdminControlBar rendering**

Change the guard from `{!presentationMode && <AdminControlBar` to `{!isActive && <AdminControlBar`:

Before:
```tsx
{!presentationMode && <AdminControlBar ... />}
```

After:
```tsx
{!isActive && <AdminControlBar ... />}
```

This hides AdminControlBar entirely when the session is active, since PresentationControls now has its own Go Live, timer, and End Session controls.

**Step 5: Remove onExitPresentationMode from PresentationControls interface**

In PresentationControls.tsx:
1. Remove `onExitPresentationMode: () => void;` from PresentationControlsProps interface
2. Remove `onExitPresentationMode,` from the destructured props
3. Remove the Exit button in the left sidebar header (the button with `onClick={onExitPresentationMode}` and text "Exit")

**Step 6: Clean up unused state variables**

After removing the non-presentation active view, check for state variables that were ONLY used in the removed block and are now unused. Candidates:
- `resultsViewIndex` / `setResultsViewIndex` — used in the results navigation of the removed view. Check if it's used elsewhere; if not, remove the state declaration.
- `expandedBatchId` / `setExpandedBatchId` — check if used only in removed block
- `addingToBatchId` / `setAddingToBatchId` — check if used only in removed block

Leave `editingQuestion`, `transitioning`, `copied`, `sessionVotes`, `quickQuestionLoading`, `lastClosedQuestionId`, `pendingBatchId`, `bulkApplyConfirm`, `bulkApplying` — these are used by other views (draft, lobby, ended) or by AdminControlBar.

**Step 7: Remove unused imports**

After removing the non-presentation active view block, some imports may become unused. Check and remove:
- `ActiveQuestionHero` — if it was only used in the removed block (it's a local component defined in AdminSession.tsx, so check if it's also used elsewhere; if not, remove the component definition too)
- `ProgressDashboard` — check if only used in removed block
- `motion`, `AnimatePresence` from 'motion/react' — check if only used in removed block's animation (the lobby and draft views may also use them; if not, remove)

Be careful: the `slideVariants` and `crossfadeVariants` objects (lines 282-298) were only used in the removed block's AnimatePresence. If no other AnimatePresence remains, remove them too.

Run `npx tsc --noEmit` after each step to catch issues incrementally.
  </action>
  <verify>
1. `npx tsc --noEmit` passes with zero errors
2. `grep -n "presentationMode" src/pages/AdminSession.tsx` returns zero results
3. `grep -n "onExitPresentationMode" src/components/PresentationControls.tsx` returns zero results
4. `grep -n "Enter Presentation" src/pages/AdminSession.tsx` returns zero results
5. The app builds successfully: `npx vite build --mode development 2>&1 | tail -5`
  </verify>
  <done>
AdminSession.tsx renders PresentationControls as the only active session view. No presentationMode state, no "Enter Presentation" button, no Exit button. AdminControlBar is hidden during active sessions. Draft, lobby, and ended views are unchanged. TypeScript compiles cleanly with no unused variables.
  </done>
</task>

<task type="auto">
  <name>Task 2: Remove active-state logic from AdminControlBar</name>
  <files>src/components/AdminControlBar.tsx</files>
  <action>
AdminControlBar is no longer rendered during active sessions (guarded by `{!isActive &&` in AdminSession.tsx). Clean up the active-state rendering code that is now dead.

**Step 1: Simplify the center content section**

In the center content div (`flex-1 min-w-0 flex items-center justify-center gap-2`), remove the `{isActive && (` block entirely (approximately lines 180-275). This includes:
- Active question display (Q number, text, countdown, close voting button)
- Batch mode active indicator with Close Batch button
- Timer selection pills
- Quick question input
- Go Live button
- Activate Next button

Keep: `isDraft`, `isLobby`, `isEnded` content blocks — these still render.

**Step 2: Simplify the right section**

In the right section, remove the `{isActive && (` block with the End Session button (approximately lines 304-312). Keep the draft Start Session and lobby Begin Voting buttons.

**Step 3: Remove unused props and state**

Remove props from AdminControlBarProps that were only used in active-state rendering:
- `activeQuestion` — only displayed in active center content
- `countdownRemaining` — only used in active countdown
- `countdownRunning` — only used in active countdown
- `onActivateQuestion` — only used in active question activation
- `onCloseVoting` — only used in active close voting button
- `onQuickQuestion` — only used in active Go Live
- `quickQuestionLoading` — only used in active Go Live loading state
- `pendingBatchId` — only used in active batch logic
- `onCloseBatch` — only used in active close batch button
- `batches` — only used in active batch activation
- `onActivateBatch` — only used in active batch activation

Keep: `status`, `participantCount`, `questions`, `transitioning`, `onStartSession`, `onBeginVoting`, `onEndSession`, `onCopyLink`, `copied`

Wait — `onEndSession` is also only used in the active right section. Remove it too if the active block is gone.

Actually, check if `onEndSession` is needed in lobby or ended states. Looking at the code: the End Session button is only in `{isActive && (...)}`. So yes, remove `onEndSession` from props.

Remove local state that was only for active rendering:
- `timerDuration` / `setTimerDuration`
- `barQuickText` / `setBarQuickText`

Remove these derived values/functions that are only used in active rendering:
- `batchModeActive` / `activeBatchId` subscription
- `pendingUnbatchedQuestions`
- `activeIndex`
- `activatableBatches`
- `NextItem` type and `nextItems` computation
- `handleBarQuickSubmit`
- `handleActivateNext`
- `getNextItemLabel`

Remove unused imports:
- `CountdownTimer` — only used in active state countdown
- `useSessionStore` — only used for activeBatchId in active state
- `Batch` type — only used in active batch logic

**Step 4: Update AdminSession.tsx callsite**

Update the AdminControlBar usage in AdminSession.tsx to remove the now-deleted props. The simplified call should be:

```tsx
{!isActive && <AdminControlBar
  status={session.status}
  participantCount={participantCount}
  questions={questions}
  transitioning={transitioning}
  onStartSession={handleStartSession}
  onBeginVoting={handleBeginVoting}
  onCopyLink={handleCopyLink}
  copied={copied}
/>}
```

Remove the props that no longer exist:
- `activeQuestion`
- `countdownRemaining`
- `countdownRunning`
- `onEndSession`
- `onActivateQuestion`
- `onCloseVoting`
- `onQuickQuestion`
- `quickQuestionLoading`
- `pendingBatchId`
- `onCloseBatch`
- `batches`
- `onActivateBatch`
  </action>
  <verify>
1. `npx tsc --noEmit` passes with zero errors
2. `npx vite build --mode development 2>&1 | tail -5` succeeds
3. AdminControlBar.tsx has no references to timer, quick question, activate, close voting, or batch logic
4. AdminControlBar is significantly smaller (should be ~80-100 lines, down from 316)
  </verify>
  <done>
AdminControlBar is a lean draft/lobby-only component. All active-state logic (timer, Go Live, question activation, batch activation, close voting) has been removed. AdminSession passes only the props needed for draft and lobby states. The component is roughly one-third its original size.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Verify presentation-only active mode</name>
  <files>src/pages/AdminSession.tsx, src/components/PresentationControls.tsx, src/components/AdminControlBar.tsx</files>
  <action>
Human verification of consolidated active session view.

What was built: Consolidated the active session experience into a single PresentationControls view. Removed the old dual-view admin interface, presentationMode toggle, and Exit button. Added Go Live, timer config, active question status, and connection status to PresentationControls. Cleaned up AdminControlBar to only handle draft and lobby states.

How to verify:
1. Navigate to an existing active session (or create one and start it)
2. Verify: The session immediately shows PresentationControls (left sidebar with sequence list, center with current/next preview, right sidebar with controls)
3. Verify: There is NO "Enter Presentation" button anywhere
4. Verify: There is NO "Exit" button in the PresentationControls header
5. Verify: Right sidebar shows Timer Duration pills (15s, 30s, 60s, None) with 30s selected by default
6. Verify: Right sidebar shows Go Live input and button
7. Verify: Type a quick question in Go Live input and press Enter or click Go Live — question activates and shows in the active question status area
8. Verify: Active question status shows question text, countdown timer (if timer set), and Close Voting button
9. Verify: Connection status indicator shows at bottom of right sidebar (green dot + "Connected")
10. Verify: Previous/Next navigation still works, keyboard shortcuts (arrows, B, ?) still work
11. Verify: Draft view (before starting session) looks normal with AdminControlBar at bottom
12. Verify: Lobby view (after starting, before begin voting) looks normal with AdminControlBar at bottom
13. Verify: Ended view looks normal
  </action>
  <verify>User approves the verification checklist above</verify>
  <done>All 13 verification items confirmed by human inspection</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with zero errors
2. `npx vite build --mode development` succeeds
3. No references to `presentationMode` in AdminSession.tsx
4. No references to `onExitPresentationMode` in PresentationControls.tsx
5. AdminControlBar does not render during active sessions
6. PresentationControls is the only view for active sessions
7. Go Live, timer config, connection status all functional in PresentationControls
8. Draft, lobby, and ended views unchanged
</verification>

<success_criteria>
- Active session shows ONE view (PresentationControls) — no toggle, no choice
- Go Live creates and activates questions with timer support
- Connection status visible in right sidebar
- AdminControlBar simplified to draft/lobby only
- All existing presentation features (navigation, QR, black screen, batch controls, reveal, reasons) work unchanged
- Zero TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/24.1-presentation-only-active-mode/24.1-02-SUMMARY.md`
</output>
