---
phase: 05-immersive-ui-and-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/index.css
  - src/components/ConnectionPill.tsx
autonomous: true

must_haves:
  truths:
    - "motion package is installed and importable from motion/react"
    - "Tailwind theme tokens for dark participant surfaces and vote colors are available as utility classes"
    - "ConnectionPill component renders a floating green dot when connected and a red pill with Disconnected text when disconnected"
  artifacts:
    - path: "src/components/ConnectionPill.tsx"
      provides: "Floating connection status pill indicator"
      exports: ["ConnectionPill"]
    - path: "src/index.css"
      provides: "Custom Tailwind theme tokens for dark surfaces and vote colors"
      contains: "@theme"
  key_links:
    - from: "src/components/ConnectionPill.tsx"
      to: "motion/react"
      via: "import { motion, AnimatePresence } from motion/react"
      pattern: "from .motion/react."
    - from: "src/components/ConnectionPill.tsx"
      to: "src/hooks/use-realtime-channel.ts"
      via: "ConnectionStatus type import"
      pattern: "ConnectionStatus"
---

<objective>
Install the Motion animation library, add Tailwind CSS custom theme tokens for the immersive dark participant experience, and create the ConnectionPill component that replaces the full-width ConnectionBanner on participant pages.

Purpose: Establishes the animation and theming foundation that all subsequent Phase 5 plans depend on. The ConnectionPill directly satisfies UIEX-03 (connection status indicator).
Output: `motion` package installed, theme tokens in index.css, ConnectionPill.tsx component ready for integration.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-immersive-ui-and-polish/05-CONTEXT.md
@.planning/phases/05-immersive-ui-and-polish/05-RESEARCH.md

Key existing files:
@src/index.css
@src/components/ConnectionBanner.tsx
@src/hooks/use-realtime-channel.ts (exports ConnectionStatus type)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install motion and add Tailwind theme tokens</name>
  <files>src/index.css</files>
  <action>
1. Install the motion package:
   ```
   npm install motion
   ```
   Verify it installs v12.x (the current stable).

2. Update `src/index.css` to add custom theme tokens after the existing `@import "tailwindcss"` line. Add a `@theme` block with these semantic color tokens:

```css
@theme {
  --color-surface-dark: oklch(0.145 0.015 264);
  --color-surface-elevated: oklch(0.205 0.015 264);
  --color-vote-agree: oklch(0.637 0.18 243);
  --color-vote-disagree: oklch(0.702 0.17 48);
}
```

These map to:
- `bg-surface-dark` -- the deep charcoal background (near gray-950)
- `bg-surface-elevated` -- slightly lighter card surface
- `bg-vote-agree` -- blue (#3B82F6 equivalent)
- `bg-vote-disagree` -- orange (#F97316 equivalent)

Do NOT remove the existing `@import "tailwindcss"` line. Add the @theme block below it.
  </action>
  <verify>
Run `npm ls motion` to confirm motion is installed.
Run `npx tsc --noEmit` to confirm no TypeScript errors.
Visually inspect src/index.css has both the import and the @theme block.
  </verify>
  <done>motion v12.x is in package.json dependencies. src/index.css has @theme block with surface-dark, surface-elevated, vote-agree, vote-disagree tokens.</done>
</task>

<task type="auto">
  <name>Task 2: Create ConnectionPill component</name>
  <files>src/components/ConnectionPill.tsx</files>
  <action>
Create a new `ConnectionPill` component that renders a small floating pill in the top-right corner of the screen. This replaces the full-width ConnectionBanner for participant pages (ConnectionBanner will remain available for admin pages).

The component:
- Imports `motion` and `AnimatePresence` from `"motion/react"`
- Imports `ConnectionStatus` type from `../hooks/use-realtime-channel`
- Accepts a `status: ConnectionStatus` prop
- Renders a fixed-position pill at `top-3 right-3 z-50`
- Connected state: small pill with a green pulsing dot (subtle `scale` animation on the dot, repeating every 2s)
- Reconnecting state: pill with yellow dot and "Reconnecting" text
- Disconnected state: red-tinted pill with red dot and "Disconnected" text
- Connecting state: pill with yellow dot (no text, similar to reconnecting but silent)
- Uses `motion.div` with `layout` prop on the pill container so it smoothly resizes when the text label appears/disappears
- Uses `AnimatePresence` to animate the text label in/out (width: 0 -> auto with opacity)

Follow the pattern from RESEARCH.md Pattern 4 closely. Key details:
- The dot uses `motion.span` with `animate={{ scale: [1, 1.3, 1] }}` and `transition={{ duration: 2, repeat: Infinity, ease: 'easeInOut' }}` when connected
- The text label uses `motion.span` with `initial={{ width: 0, opacity: 0 }}`, `animate={{ width: 'auto', opacity: 1 }}`, `exit={{ width: 0, opacity: 0 }}`
- Pill background: connected = `bg-gray-800/80 text-gray-400`, disconnected = `bg-red-900/90 text-red-200`, reconnecting = `bg-yellow-900/90 text-yellow-200`, connecting = `bg-gray-800/80 text-gray-400`
- Export as named export: `export function ConnectionPill`

Do NOT modify ConnectionBanner.tsx -- it stays as-is for potential admin use.
  </action>
  <verify>
Run `npx tsc --noEmit` to confirm no TypeScript errors.
Check that ConnectionPill.tsx exports the ConnectionPill function.
Confirm it imports from "motion/react" (not "framer-motion").
  </verify>
  <done>ConnectionPill.tsx exists, exports ConnectionPill component, imports motion from "motion/react", accepts ConnectionStatus prop, renders fixed pill with animated green/red/yellow dot and conditional text label.</done>
</task>

</tasks>

<verification>
1. `npm ls motion` shows motion v12.x installed
2. `npx tsc --noEmit` passes with zero errors
3. `src/index.css` contains @theme block with 4 color tokens
4. `src/components/ConnectionPill.tsx` exists and exports ConnectionPill
5. ConnectionPill imports from "motion/react" (not "framer-motion")
</verification>

<success_criteria>
- motion v12.x is installed and TypeScript can import from "motion/react"
- Tailwind theme tokens (surface-dark, surface-elevated, vote-agree, vote-disagree) are defined in index.css
- ConnectionPill component is created with animated status indicator (green dot when connected, red pill when disconnected)
- Build passes with zero TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/05-immersive-ui-and-polish/05-01-SUMMARY.md`
</output>
