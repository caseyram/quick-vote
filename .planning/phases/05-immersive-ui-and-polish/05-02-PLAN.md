---
phase: 05-immersive-ui-and-polish
plan: 02
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - src/components/VoteAgreeDisagree.tsx
  - src/components/VoteMultipleChoice.tsx
  - src/components/VoteConfirmation.tsx
autonomous: true

must_haves:
  truths:
    - "Vote buttons use motion.button with color fill animation (blue for agree, orange for disagree) against dark background"
    - "Tapping a vote option triggers a scale pulse animation (1 -> 1.05 -> 1) on selection"
    - "Vote buttons have whileTap scale-down feedback (0.97) for tactile press feel"
    - "Lock-in overlay animates in with scale+opacity via AnimatePresence and shows a checkmark with pathLength draw animation"
    - "Changing vote instantly swaps color (no lingering animation on deselected option)"
  artifacts:
    - path: "src/components/VoteAgreeDisagree.tsx"
      provides: "Motion-animated agree/disagree vote buttons"
      min_lines: 80
    - path: "src/components/VoteMultipleChoice.tsx"
      provides: "Motion-animated multiple choice vote buttons"
      min_lines: 80
    - path: "src/components/VoteConfirmation.tsx"
      provides: "AnimatePresence lock-in confirmation overlay"
      min_lines: 20
  key_links:
    - from: "src/components/VoteAgreeDisagree.tsx"
      to: "motion/react"
      via: "motion.button and useAnimate imports"
      pattern: "from .motion/react."
    - from: "src/components/VoteMultipleChoice.tsx"
      to: "motion/react"
      via: "motion.button and useAnimate imports"
      pattern: "from .motion/react."
    - from: "src/components/VoteConfirmation.tsx"
      to: "motion/react"
      via: "motion.div, motion.svg, AnimatePresence imports"
      pattern: "AnimatePresence"
---

<objective>
Refactor the three vote interaction components (VoteAgreeDisagree, VoteMultipleChoice, VoteConfirmation) to use Motion animations for the tactile, "bold and confident" voting experience specified in CONTEXT.md.

Purpose: This is the core of UIEX-01 -- vote selection must feel like color-fill-and-pulse, not like clicking a form radio button. The whileTap press feedback, color fill animation, and lock-in overlay animation create the immersive tactile identity.
Output: All three vote components use motion.button/motion.div with animated interactions, replacing CSS transition-all.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-immersive-ui-and-polish/05-CONTEXT.md
@.planning/phases/05-immersive-ui-and-polish/05-RESEARCH.md
@.planning/phases/05-immersive-ui-and-polish/05-01-SUMMARY.md

Key existing files:
@src/components/VoteAgreeDisagree.tsx
@src/components/VoteMultipleChoice.tsx
@src/components/VoteConfirmation.tsx
@src/components/BarChart.tsx (for AGREE_DISAGREE_COLORS and MULTI_CHOICE_COLORS constants)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Refactor VoteAgreeDisagree and VoteMultipleChoice with Motion animations</name>
  <files>src/components/VoteAgreeDisagree.tsx, src/components/VoteMultipleChoice.tsx</files>
  <action>
Refactor both vote components to replace CSS `transition-all` with Motion's declarative animation API. The components share the same animation pattern, applied differently for their layouts.

**For VoteAgreeDisagree.tsx:**

1. Add imports: `import { motion, useAnimate } from "motion/react";`
2. Import color constants: `import { AGREE_DISAGREE_COLORS } from './BarChart';`
3. Define unselected color constant: `const UNSELECTED = 'rgba(55, 65, 81, 0.5)';` (gray-700 at 50% opacity)
4. Replace each `<button>` with `<motion.button>`:
   - Remove ALL CSS transition classes: `transition-all`, `duration-150`, `scale-[1.02]`
   - Remove CSS color state classes (`bg-green-600`, `bg-green-700/50`, `bg-red-600`, `bg-red-700/50`, `ring-4`, `ring-green-400`, `ring-red-400`)
   - Add `animate={{ backgroundColor: isSelected ? color : UNSELECTED }}` where color is `AGREE_DISAGREE_COLORS.agree` (blue #3B82F6) for agree and `AGREE_DISAGREE_COLORS.disagree` (orange #F97316) for disagree
   - Add `whileTap={!isLockedIn && !submitting ? { scale: 0.97 } : undefined}` for press feedback
   - Add `transition={{ backgroundColor: { duration: 0.15 }, scale: { duration: 0.1 } }}`
   - Keep: `rounded-2xl`, `text-white`, `text-2xl`, `font-bold`, `flex-1`, `flex flex-col items-center justify-center`
   - Keep: `disabled={isLockedIn || submitting}` prop
   - Keep: `style={{ touchAction: 'manipulation', WebkitTapHighlightColor: 'transparent' }}`
   - Add: `className="... disabled:opacity-60 disabled:cursor-not-allowed"` (Tailwind handles disabled state)
5. Add selection pulse using `useAnimate`:
   - Create `const [agreeRef, animateAgree] = useAnimate();` and `const [disagreeRef, animateDisagree] = useAnimate();`
   - Track previous selection with `const prevSelected = useRef(selectedValue);`
   - In a `useEffect` watching `selectedValue`, when the value changes TO 'agree' or 'disagree' (and was previously different), trigger: `animate(ref.current, { scale: [1, 1.05, 1] }, { duration: 0.3, ease: 'easeOut' })`
   - Attach refs to the corresponding motion.button elements
6. Keep the SVG icons (thumbs up/down) as-is. Keep the "Tap again to lock in" text.
7. Remove the green/red color scheme. Use blue (#3B82F6) for agree, orange (#F97316) for disagree per CONTEXT.md and BarChart.tsx colors. The "Tap again to lock in" span should use `text-white/70` instead of `text-green-200`/`text-red-200`.

**For VoteMultipleChoice.tsx:**

1. Same motion imports as above.
2. Import `MULTI_CHOICE_COLORS` from `./BarChart`.
3. Define `const UNSELECTED = 'rgba(55, 65, 81, 0.5)';`
4. Replace each option `<button>` with `<motion.button>`:
   - Remove CSS transition classes and CSS color state classes (`bg-indigo-600`, `ring-4`, `ring-indigo-400`, `scale-[1.01]`, `bg-gray-800`, `hover:bg-gray-700`)
   - Each option gets a color from `MULTI_CHOICE_COLORS[index % MULTI_CHOICE_COLORS.length]`
   - Add `animate={{ backgroundColor: isSelected ? optionColor : UNSELECTED }}`
   - Add `whileTap` and `transition` same as agree/disagree
   - Keep: `rounded-xl`, `text-white`, `font-semibold`, `text-left`, compact vs normal sizing
   - Keep: `touchAction` and `WebkitTapHighlightColor` styles
5. For the pulse effect, use a single `useAnimate` ref approach: since options are mapped, use an imperative `animate` call inside the click handler instead of a ref-per-option. After calling `handleTap(option)`, if the option is newly selected, trigger the pulse on the button element via a ref callback or by using the motion `animate` prop with a key-based approach.
   - Simpler approach: use the `animate` prop with a scale keyframe when `isSelected` transitions. Set `animate={{ backgroundColor: ..., scale: isSelected ? [1, 1.05, 1] : 1 }}` -- BUT this replays on every render. Better: track selection changes with a key pattern.
   - Recommended approach for multiple choice: Use `animate={{ backgroundColor: isSelected ? color : UNSELECTED }}` for the background, and handle the pulse imperatively. Create a ref map or simply use a single `useAnimate` + useEffect pattern that finds the selected element.
   - Simplest correct approach: Accept that the pulse is a nice-to-have for multiple choice. The `whileTap={{ scale: 0.97 }}` press feedback and the instant color fill already provide strong tactile feedback. Skip the selection pulse for multiple choice to keep the code clean. The color fill animation IS the primary feedback.
6. Replace "Tap again to lock in" color from `text-indigo-200` to `text-white/70`.

**Critical -- what to avoid and why:**
- Do NOT use CSS `transition-*` classes alongside Motion's `animate` prop (causes doubled animations per RESEARCH.md Pitfall 4)
- Do NOT use `motion()` factory (deprecated in v11.5+, use `motion.button` directly)
- Do NOT add `layout` prop to vote buttons (performance impact per RESEARCH.md anti-patterns)
- Do NOT change the voting logic (submitVote, handleTap, useDoubleTap, useHaptic) -- only change the rendering/animation layer
  </action>
  <verify>
Run `npx tsc --noEmit` to confirm no TypeScript errors.
Grep both files for "transition-all" to confirm CSS transitions are removed.
Grep both files for "motion.button" to confirm Motion is used.
Grep both files for "whileTap" to confirm press feedback is present.
  </verify>
  <done>
VoteAgreeDisagree uses motion.button with blue/orange color fill, whileTap scale feedback, and selection pulse animation. VoteMultipleChoice uses motion.button with per-option color fill from MULTI_CHOICE_COLORS and whileTap feedback. No CSS transition-all classes remain. Build passes.
  </done>
</task>

<task type="auto">
  <name>Task 2: Refactor VoteConfirmation with AnimatePresence lock-in animation</name>
  <files>src/components/VoteConfirmation.tsx</files>
  <action>
Replace the CSS opacity transition lock-in overlay with a Motion AnimatePresence animation.

1. Add imports: `import { motion, AnimatePresence } from "motion/react";`
2. Change the component interface: keep `visible: boolean` and `value: string` props.
3. Replace the current div (which uses CSS `transition-opacity` and `pointer-events-none`) with an `AnimatePresence` wrapper:

```tsx
<AnimatePresence>
  {visible && (
    <motion.div
      initial={{ opacity: 0, scale: 0.8 }}
      animate={{ opacity: 1, scale: 1 }}
      exit={{ opacity: 0, scale: 0.8 }}
      transition={{ duration: 0.3, ease: 'easeOut' }}
      className="absolute inset-0 flex flex-col items-center justify-center bg-gray-950/80 rounded-lg z-10"
    >
      {/* Checkmark with draw-in animation */}
      <motion.svg ...>
        <motion.path
          initial={{ pathLength: 0 }}
          animate={{ pathLength: 1 }}
          transition={{ duration: 0.4, delay: 0.1, ease: 'easeOut' }}
          ... (same d path as current checkmark)
        />
      </motion.svg>
      <p className="text-white text-xl font-semibold">Locked in!</p>
      <p className="text-gray-400 text-sm mt-1">{value}</p>
    </motion.div>
  )}
</AnimatePresence>
```

4. For the SVG checkmark draw animation:
   - Use `<motion.svg>` with same className and viewBox as current
   - Use `<motion.path>` with `initial={{ pathLength: 0 }}` and `animate={{ pathLength: 1 }}`
   - Set `fill="none"` and `stroke="currentColor"` on the path
   - This creates a satisfying "drawing" effect where the checkmark traces in
5. Remove the CSS `transition-opacity duration-300` and `opacity-0`/`opacity-100` / `pointer-events-auto`/`pointer-events-none` pattern entirely -- AnimatePresence handles mount/unmount.

**What to avoid:**
- Do NOT wrap AnimatePresence children in an extra div -- the motion.div must be the DIRECT child of AnimatePresence (Pitfall 1 from RESEARCH.md)
- Do NOT keep CSS transition classes (would conflict with Motion animation)
  </action>
  <verify>
Run `npx tsc --noEmit` to confirm no TypeScript errors.
Grep for "AnimatePresence" in VoteConfirmation.tsx to confirm Motion is used.
Grep for "transition-opacity" to confirm CSS transition is removed.
Grep for "pathLength" to confirm checkmark draw animation is present.
  </verify>
  <done>VoteConfirmation uses AnimatePresence with scale+opacity entrance/exit animation and a checkmark draw-in animation via motion.path pathLength. No CSS transition-opacity classes remain. Build passes.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with zero errors
2. VoteAgreeDisagree.tsx uses `motion.button` with `animate` and `whileTap` props, blue/orange colors
3. VoteMultipleChoice.tsx uses `motion.button` with `animate` and `whileTap` props, MULTI_CHOICE_COLORS
4. VoteConfirmation.tsx uses `AnimatePresence` with `motion.div` and `motion.path` for draw animation
5. No file contains both `transition-all` (CSS) and `motion.button` (Motion) on the same element
6. All three files import from `"motion/react"`
</verification>

<success_criteria>
- Vote buttons animate with color fill (not CSS class toggle) when selected
- Vote buttons respond to tap with scale-down feedback (whileTap)
- Agree uses blue (#3B82F6), disagree uses orange (#F97316) -- matching BarChart colors
- Lock-in overlay animates in with scale+opacity and checkmark draws in
- No CSS transition classes conflict with Motion animations
- Build passes with zero TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/05-immersive-ui-and-polish/05-02-SUMMARY.md`
</output>
