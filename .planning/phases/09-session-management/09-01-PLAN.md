---
phase: 09-session-management
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/pages/AdminList.tsx
  - src/components/ConfirmDialog.tsx
  - src/App.tsx
autonomous: true

must_haves:
  truths:
    - "Admin can access /admin URL to see list of all sessions"
    - "Session list shows name, date, question count, participant count"
    - "Session list is ordered by timestamp, most recent first"
    - "Admin can search sessions by name"
    - "Admin can delete a session with confirmation"
    - "Admin can create a new session from list"
  artifacts:
    - path: "src/pages/AdminList.tsx"
      provides: "Session list page with search, delete, new session"
      min_lines: 100
    - path: "src/components/ConfirmDialog.tsx"
      provides: "Reusable confirmation modal"
      min_lines: 30
    - path: "src/App.tsx"
      provides: "/admin route"
      contains: "path=\"/admin\""
  key_links:
    - from: "src/App.tsx"
      to: "src/pages/AdminList.tsx"
      via: "Route element"
      pattern: "element=.*AdminList"
    - from: "src/pages/AdminList.tsx"
      to: "supabase"
      via: "session query with aggregates"
      pattern: "from\\('sessions'\\)"
---

<objective>
Create the /admin route with session list, search filtering, delete with confirmation, and new session button.

Purpose: Provides the global entry point for admin session management (SESS-01, SESS-02).
Output: AdminList.tsx page, ConfirmDialog.tsx component, /admin route in App.tsx
</objective>

<execution_context>
@C:\Users\cramo\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\cramo\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-session-management/09-CONTEXT.md
@.planning/phases/09-session-management/09-RESEARCH.md

@src/App.tsx
@src/components/PastSessions.tsx
@src/components/ImportExportPanel.tsx
@src/lib/supabase.ts
@src/types/database.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ConfirmDialog component</name>
  <files>src/components/ConfirmDialog.tsx</files>
  <action>
Create a reusable confirmation dialog component following the pattern from ImportExportPanel.tsx modal:

```typescript
interface ConfirmDialogProps {
  isOpen: boolean;
  onConfirm: () => void;
  onCancel: () => void;
  title: string;
  message: string;
  confirmLabel?: string;
  confirmVariant?: 'danger' | 'primary';
  loading?: boolean;
}
```

Implementation:
- Fixed overlay with bg-black/50 and z-50
- White card centered with max-w-md
- Title (text-lg font-semibold), message (text-sm text-gray-500)
- Cancel button (text-gray-600 hover:text-gray-800)
- Confirm button: danger variant = red-600, primary = indigo-600
- Support loading state (disabled + "Deleting..." text for danger)
- Return null if !isOpen

Follow ImportExportPanel.tsx modal styling exactly (rounded-xl, p-6, space-y-4).
  </action>
  <verify>File exists at src/components/ConfirmDialog.tsx with proper TypeScript interface and JSX</verify>
  <done>ConfirmDialog component exists with isOpen, onConfirm, onCancel, title, message props and danger/primary variants</done>
</task>

<task type="auto">
  <name>Task 2: Create AdminList page with session list</name>
  <files>src/pages/AdminList.tsx</files>
  <action>
Create the AdminList page component:

1. **State:**
   - sessions: SessionWithStats[] (Session + question_count + participant_count)
   - loading: boolean
   - searchTerm: string
   - debouncedTerm: string (debounced 300ms)
   - deleteTarget: SessionWithStats | null (for confirm dialog)
   - deleting: boolean

2. **Session fetch query** (from RESEARCH.md):
```typescript
const { data } = await supabase
  .from('sessions')
  .select('*, questions(count), votes(participant_id)')
  .eq('created_by', user.id)
  .order('created_at', { ascending: false });

// Map to add computed stats
const rows = data.map(session => ({
  ...session,
  question_count: session.questions[0]?.count ?? 0,
  participant_count: new Set(session.votes?.map(v => v.participant_id) ?? []).size,
}));
```

3. **Debounced search** (from RESEARCH.md):
```typescript
useEffect(() => {
  const timer = setTimeout(() => setDebouncedTerm(searchTerm), 300);
  return () => clearTimeout(timer);
}, [searchTerm]);

const filteredSessions = useMemo(() => {
  return sessions.filter(s =>
    s.title.toLowerCase().includes(debouncedTerm.toLowerCase())
  );
}, [sessions, debouncedTerm]);
```

4. **New Session handler** - create session and navigate to admin view:
```typescript
const newSessionId = nanoid();
const { data } = await supabase.from('sessions').insert({
  session_id: newSessionId,
  title: 'Untitled Session',
  created_by: user.id,
}).select('admin_token').single();
navigate(`/admin/${data.admin_token}`);
```

5. **Delete handler** - delete session with cascade (votes, questions, batches auto-deleted by FK):
```typescript
await supabase.from('sessions').delete().eq('id', deleteTarget.id);
setSessions(s => s.filter(x => x.id !== deleteTarget.id));
setDeleteTarget(null);
```

6. **UI Layout (light theme, matching admin aesthetic):**
   - Header with "Sessions" title and "New Session" button (indigo-600)
   - Search input below header (px-4 py-2.5, border-gray-300, rounded-lg, placeholder "Search sessions...")
   - Session cards in a list (gap-3)
   - Each card shows: title, status badge (reuse statusColors from PastSessions), date, question count, participant count
   - Each card has: "Open" button (navigate to admin), "Export" button (placeholder - will be wired in Plan 03), "Delete" button (red text)
   - ConfirmDialog for delete confirmation

7. **Empty states:**
   - No sessions: "No sessions yet. Create your first session to get started."
   - No search results: "No sessions match your search."

Use useNavigate from react-router, nanoid for session IDs.
  </action>
  <verify>File exists at src/pages/AdminList.tsx with session fetching, search, delete, and new session functionality</verify>
  <done>AdminList page shows sessions with stats, supports search filtering, delete with confirmation, and new session creation</done>
</task>

<task type="auto">
  <name>Task 3: Add /admin route to App.tsx</name>
  <files>src/App.tsx</files>
  <action>
Update App.tsx to add the /admin route:

1. Import AdminList:
```typescript
import AdminList from './pages/AdminList';
```

2. Add route before the parameterized routes:
```typescript
<Routes>
  <Route path="/" element={<Home />} />
  <Route path="/admin" element={<AdminList />} />
  <Route path="/admin/:adminToken" element={<AdminSession />} />
  <Route path="/session/:sessionId" element={<ParticipantSession />} />
</Routes>
```

The /admin route must come BEFORE /admin/:adminToken so it matches first.
  </action>
  <verify>Run `npm run build` - should compile without errors. Verify route order is correct in App.tsx.</verify>
  <done>/admin route exists in App.tsx and renders AdminList component</done>
</task>

</tasks>

<verification>
1. `npm run build` compiles without errors
2. Navigate to /admin - see session list page
3. Search filters sessions by name (300ms debounce)
4. "New Session" creates a session and navigates to admin view
5. Delete shows confirmation dialog and removes session on confirm
6. Session cards show: title, status, date, question count, participant count
7. List is ordered by created_at descending (most recent first)
</verification>

<success_criteria>
- SESS-01: Admin can access /admin URL to see list of all sessions
- SESS-02: Session list ordered by timestamp, most recent first
- Admin can search sessions by name
- Admin can delete sessions with confirmation
- Admin can create new sessions from list
</success_criteria>

<output>
After completion, create `.planning/phases/09-session-management/09-01-SUMMARY.md`
</output>
