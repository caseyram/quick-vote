---
phase: 23-preview-system
plan: 02
type: execute
wave: 2
depends_on: ["23-01"]
files_modified:
  - src/components/editor/PreviewControls.tsx
  - src/components/editor/PreviewParticipant.tsx
  - src/components/editor/SessionPreviewOverlay.tsx
autonomous: true

must_haves:
  truths:
    - "Admin Controls panel shows interactive navigation that advances all 3 views simultaneously"
    - "Admin Controls panel displays a sequence list with current item highlighted"
    - "Participant View panel shows a static voting mockup at phone-like proportions"
    - "Participant View shows mock pre-selected vote state for each question type"
    - "All three panels update in sync when navigating"
  artifacts:
    - path: "src/components/editor/PreviewControls.tsx"
      provides: "Admin controls panel with next/prev buttons, sequence list, and position indicator"
    - path: "src/components/editor/PreviewParticipant.tsx"
      provides: "Participant view panel with static vote mockup at phone proportions"
    - path: "src/components/editor/SessionPreviewOverlay.tsx"
      provides: "Updated overlay with all 3 panels wired to shared navigation state"
  key_links:
    - from: "src/components/editor/SessionPreviewOverlay.tsx"
      to: "PreviewControls"
      via: "onNext, onPrev, currentIndex, items props"
      pattern: "PreviewControls.*onNext.*onPrev"
    - from: "src/components/editor/SessionPreviewOverlay.tsx"
      to: "PreviewParticipant"
      via: "item prop from shared navigation state"
      pattern: "PreviewParticipant.*item="
    - from: "src/components/editor/PreviewParticipant.tsx"
      to: "preview-mock-data.ts"
      via: "MOCK_PARTICIPANT_COUNT import for display"
      pattern: "MOCK_PARTICIPANT_COUNT"
---

<objective>
Build the Admin Controls and Participant View preview panels, completing the three-view preview experience.

Purpose: The projection panel (Plan 01) shows what the screen looks like. This plan adds the admin controls (interactive navigation with sequence list) and the participant view (static voting mockup at phone proportions), creating the full three-view synchronized preview per the phase requirements.

Output: PreviewControls and PreviewParticipant components wired into SessionPreviewOverlay, completing the side-by-side preview experience.
</objective>

<execution_context>
@C:/Users/cramo/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/cramo/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/23-preview-system/23-RESEARCH.md
@.planning/phases/23-preview-system/23-CONTEXT.md
@.planning/phases/23-preview-system/23-01-SUMMARY.md

Key source files:
@src/components/editor/SessionPreviewOverlay.tsx — overlay shell with placeholder panels
@src/components/editor/PreviewProjection.tsx — projection panel (already built)
@src/components/editor/preview-mock-data.ts — mock data utilities
@src/stores/template-editor-store.ts — EditorItem, EditorQuestion types
@src/components/BarChart.tsx — BarChart component with color constants
</context>

<tasks>

<task type="auto">
  <name>Task 1: PreviewControls panel with interactive navigation</name>
  <files>
    src/components/editor/PreviewControls.tsx
  </files>
  <action>
Create `PreviewControls.tsx` — a styled approximation of what the admin control view looks like during a live session, adapted for the preview context.

Props: `{ items: EditorItem[]; currentIndex: number; onNext: () => void; onPrev: () => void; onGoTo: (index: number) => void }`

Layout (light theme, all within the panel bounds):

1. **Navigation controls** at top — compact row with:
   - Previous button (left arrow icon, disabled at first item)
   - Position indicator: "Item {currentIndex + 1} of {items.length}"
   - Next button (right arrow icon, disabled at last item)
   - Buttons use `bg-indigo-600 hover:bg-indigo-500 text-white rounded px-3 py-1.5 text-sm` style, matching existing admin button patterns. Disabled state: `opacity-50 cursor-not-allowed`.

2. **Sequence list** below navigation — scrollable list of items:
   - Each item is a row with: position number, icon (image icon for slides, list icon for batches), item name (batch name or "Slide" + caption truncated), and item type badge.
   - Current item row highlighted with `bg-indigo-50 border-l-4 border-indigo-500` to show active position.
   - Non-active items: `hover:bg-gray-50` with `border-l-4 border-transparent`.
   - Clicking any row calls `onGoTo(index)` to jump to that item.
   - Use `overflow-y-auto flex-1` on the list container so it scrolls within the panel.

3. **Mock session info** at bottom — small info section:
   - "12 participants connected" (using MOCK_PARTICIPANT_COUNT from preview-mock-data.ts)
   - "Session: Active" with a green dot indicator
   - Light gray background: `bg-gray-50 rounded-lg p-3 text-sm text-gray-600`

All text uses light theme colors (gray-900 for primary, gray-500 for secondary).
  </action>
  <verify>
`npx tsc --noEmit` passes. PreviewControls.tsx exists and exports the component with the correct props interface.
  </verify>
  <done>
PreviewControls renders navigation buttons, a scrollable sequence list with active item highlighting, click-to-jump navigation, and mock session info. All in light theme.
  </done>
</task>

<task type="auto">
  <name>Task 2: PreviewParticipant panel and overlay integration</name>
  <files>
    src/components/editor/PreviewParticipant.tsx
    src/components/editor/SessionPreviewOverlay.tsx
  </files>
  <action>
Create `PreviewParticipant.tsx` — a static mockup of what participants see on their phone, rendered at phone-like proportions (no device frame per user decision).

Props: `{ item: EditorItem }`

Layout:
- Outer container constrains to phone-like proportions: `max-w-[320px] mx-auto h-full` within the panel. This gives a narrow, tall layout without a device frame.
- All light theme (per user decision — do NOT use the dark participant theme).
- Content area with light background (`bg-gray-50`), rounded corners, and `overflow-y-auto`.

Rendering per item type:

1. **Slide items:** Show a "Waiting for presenter" message centered, with a subtle animated pulse dot. This mimics what participants see when the admin is on a content slide (participants don't see slides). Use `text-gray-500 text-center` with a small animation.

2. **Batch items:** Show a static voting mockup for the first question in the batch:
   - Question text at top: `text-lg font-semibold text-gray-900 mb-4`
   - Progress indicator: "Question 1 of {batch.questions.length}" in small text
   - Vote buttons based on question type:
     - **agree_disagree:** Three stacked buttons — "Agree" (blue-500 bg, white text, slightly larger/emphasized to indicate pre-selected state), "Sometimes" (gray outline), "Disagree" (gray outline). The "Agree" button has a selected visual state (filled background) to show a mock pre-voted state.
     - **multiple_choice:** Stacked option buttons, with the first option showing a selected state (filled indigo bg, white text) and the rest in outline style.
   - All buttons are static (no click handlers) — purely visual mockup per Claude's discretion (static mockup chosen over clickable no-ops for simplicity).
   - Below the buttons: a subtle "Your vote has been recorded" confirmation text in green-600, simulating the post-vote state.

3. **Empty batch (no questions):** Show "No questions available" centered text.

Update `SessionPreviewOverlay.tsx`:
- Replace the "Controls — Plan 02" placeholder with `<PreviewControls items={items} currentIndex={currentIndex} onNext={handleNext} onPrev={handlePrev} onGoTo={(index) => setCurrentIndex(index)} />`.
- Replace the "Participant — Plan 02" placeholder with `<PreviewParticipant item={currentItem} />`.
- Import both new components.
- Ensure currentItem is passed correctly (handle edge case where items[currentIndex] might be undefined if items array is empty — use optional chaining or early return for empty state).
  </action>
  <verify>
1. `npx tsc --noEmit` passes with no errors.
2. All three panels render real content in the preview overlay.
3. Clicking next/prev in the controls panel updates all three panels simultaneously.
4. Clicking a sequence list item jumps all panels to that item.
5. Participant panel shows phone-proportioned voting mockup.
  </verify>
  <done>
All three preview panels render synchronized content. Controls panel has interactive navigation that advances all views. Participant panel shows static vote mockup at phone proportions with pre-selected vote state. All light theme, no device frames.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` — no TypeScript errors
2. Preview overlay shows all 3 functional panels side-by-side
3. Click next/prev in controls → projection crossfades, controls highlight updates, participant shows new question
4. Click item in sequence list → all panels jump to that item
5. Participant view renders at phone-like proportions (narrow, centered)
6. Participant view shows "Waiting for presenter" on slides, voting mockup on batches
7. Mock session info shows "12 participants connected" and "Session: Active"
</verification>

<success_criteria>
- PreviewControls has interactive navigation (next/prev/go-to) that syncs all 3 views
- PreviewControls shows scrollable sequence list with active item highlighted
- PreviewParticipant shows static voting mockup at phone proportions
- All three panels update simultaneously on navigation
- TypeScript compiles cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/23-preview-system/23-02-SUMMARY.md`
</output>
